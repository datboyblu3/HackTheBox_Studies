
Pivoting allows you to redirect traffic from one port to another. For example, it can help you to access a service that may sit behind a firewall. 

**Accessing the MySQL server in Ubuntu. Forward our local port (1234) over SSH to the Ubuntu server**

The `-L` command tells the SSH client to request the SSH server to forward all the data we send via the port `1234` to `localhost:3306` on the Ubuntu server
```python
ssh -L 1234:localhost:3306 ubuntu@10.129.202.64
```

**Confirm Port Forwarding with Netstat**
```python
netstat -antp | grep 1234
```

**Confirm Port forwarding with NMAP**
```python
nmap -v -sV -p1234 localhost
```

**Forwarding Multiple Ports**

The below command forwards the apache web server's port 80 to your attack host's local port on port `8080`. The syntax is `local port:server:port`
```python
ssh -L 1234:localhost:3306 -L 8080:localhost:80 ubuntu@10.129.202.64
```

### SSH Tunneling over SOCKS Proxy

- This is done by starting a SOCKS listener on your localhost, then configuring SSH to forward that traffic via SSH to the target network after connecting to the target host.
- Initial traffic is generated by a SOCKS client, which connects to the SOCKS server controlled by the user who wants to access a service on the client-side. Once the connection is established, network traffic can be routed through the SOCKS server on behalf of the connected client.
- SOCKS proxies can pivot via creating a route to an external server from `NAT networks`

![[Pasted image 20240923215349.png]]

### Dynamic Port Forwarding with SSH

-D enables dynamic port forwarding
```python
ssh -D 9050 ubuntu@10.129.202.64
```

Now, route packets over 9050 via proxychains. First, configure `/etc/proxychains.conf` , adding `socks4 127.0.0.1 9050` to the last line, if not there

Starting Nmap with proxychains will route all packets over 9050 to the 172.16.5.0/24 network
```python
proxychains nmap -v -sn 172.16.5.1-200
```

#### Things to Note
- Routing traffic via proxychains and forwarding it to a remote server is called `SOCKS tunneling`
- Proxychains only allows `full TCP Connect Scan`
- `host alive` checks will fail against Windows machines because of Windows Defender Firewall blocking ICMP requests

### Enumerating Windows through Proxychains
```python
proxychains nmap -v -Pn -sT 172.16.5.19
```

### Metasploit with Proxychains
```python
proxychains msfconsole
```

- use the `rdp_scanner` auxiliary module to check if the host on the internal network is listening on 3389

 **rdp_scanner Module**
 ```python
 search rdp_scanner
```

### Using xfreerdp with Proxychains
```python
proxychains xfreerdp /v:172.16.5.19 /u:victor /p:pass@123
```

# Questions

Username
```python
ubuntu
```

Password
```python
HTB_@cademy_stdnt!
```

### RDP Credentials

Username
```python
victor
```

Password
```python
pass@123
```

Windows Target
```python
172.16.5.19
```

Scan target with nmap and proxychains
```python
proxychains nmap -v -sn 10.129.25.174
```







